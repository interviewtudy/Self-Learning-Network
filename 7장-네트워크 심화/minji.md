# 안정성을 위한 기술

## 가용성

컴퓨터 시스템이 특정 기능을 실제로 수행할 수 있는 시간의 비율로 컴퓨터 시스템은 서버가 될 수도 있고 네트워크가 될 수도 있으며 프로그램이 될 수도 있음

- 안정성: 특정 기능을 언제든 균일한 성능으로 수행할 수 있는 특성으로 가용성, 고가용성이라는 용어로 정도를 나타냄
- 가용성 = 업타임 / (업타임 + 다운타임)
- 업타임: 정상적인 사용 시간
- 다운타임: 정상적인 사용이 불가능한 시간
- 고가용성(HA, High Availability): 가용성이 높은 성질을 의미
- 안정적이라고 평가받는 시스템은 가용성 99.999% 이상을 목표로 하며 파이브 나인스라고도 표현함 -> 다운타임이 1년에 5.26분, 월에 26.3초
- 서비스 다운의 원인으로는 과대한 트래픽, 예기지 못한 소프트웨어상의 오류, 하드웨어 장애, 보안 공격, 자연재해 등 다양하며 모든 다운타임의 발생 원인을 원천적으로 차단하긴 어려움 -> 문제가 발생해도 계속 기능할 수 있도록 설계하는 것이 중요함
- 결함 감내: 문제가 발생하더라도 기능할 수 있는 능력

<br/><br/>

## 이중화

무언가를 이중으로 두는 기술로 결함을 감내하여 가용성을 높이기 위한 가장 기본적이고 대표적인 방법을 나타냄

- 서버 컴퓨터, 네트워크, 인터페이스(NIC), 스위치와 같은 물리적 장비부터 데이터베이스, 웹 서버 프로그램 등 단일 장애점은 전부 이중화하는 것이 가능함
- 단일 장애점(SPOF, Single Point Of Failure): 문제가 발생할 경우 시스템 전체가 중단될 수 있는 대상
- SPOF 는 최대한 없애는 것이 좋으며 가용성을 높이기 위해서는 SPOF 를 이중화하는 것이 좋음
- 이중화 구성
  - 액티브/스탠바이: 액티브는 가동 상태를 스탠바이는 액티브의 백업으로서 대기하는 상태로, 액티브 시스템에 문제가 발생할 경우 스탠바이 시스템이 자동으로 액티브 세스템을 대신하여 동작함. 안전한 구성 방식이지만 하나의 장비를 사용할 때에 비해 크게 성능 변화를 느끼긴 어려움.
  - 액티브/액티브: 두 시스템 모두 가동하고 있는 상태. 두 시스템이 함께 가동되므로 부하를 분산시킬 수 있고 성능상의 이점이 있음. 다만 한 시스템에 문제가 발생하면 순간적으로 다른 시스템에 부하가 급증할 수 있고 이로인한 추가적인 문제가 발생할 수 있음
- 페일 오버(failover): 액티브 시스템에 문제가 생겼을 경우 예비된 스탠바이 시스템으로 자동 전환되는 기능
- 다중화: 무언가를 여러 개 두는 기술로, 이중화된 구성에 비해 더욱 안정적인 운영이 가능함
- 티밍(teaming)&본딩(bonding): 이중화/다중화의 사례로, 윈도우에서는 티밍, 리눅스에서는 본딩이라고 함. 여러 개의 네트워크 인터페이스(NIC)를 이중화/다중화하여 마치 더 뛰어나고 안정적인 성능을 보유한 하나의 인터페이스처럼 보이게 하는 기술. 티밍 시 액티브/액티브로 구성할지, 액티브/스탠바이로 구성할지 선택할 수 있음

<br/><br/>

## 로드 밸런싱

트래픽의 고른 분배를 위해 사용됟는 기술

- 트래픽: 주어진 시점에 특정 노드를 경유한 패킷의 양
- 서버에 과도한 트래픽이 몰리면 CPU 발열 심화, 메모리 공간 부족, 제한된 대역폭과 병목 현상으로 인해 응답이 느려지거나 일부 요쳥에 대한 응답이 누락, 프로그램 일관성 손상등의 문제가 발생할 수 있음 -> 가용성 떨어뜨림
- 서버를 다중화한 후에 트래픽을 고르게 분산해야 가용성이 높아짐
- 로드 밸런서를 통해 수행됨
- L4 스위치, L7 스위치라고 불리는 네트워크 장비로도 수행할 수 있지만 로드 밸런싱 기능을 제공하는 소프트웨어를 설치하면 일반 호스트도 로드 밸런서로 사용할 수 있음 (ex. HAProxy, Envoy, Nginx)
  - L4 스위치: IP주소와 포트 번호와 같은 전송 계층까지의 정보를 바탕으로 로드 밸런싱을 수행
  - L7 스위치: URI, HTTP 메시지 일부, 쿠키 등 응용 계층의 정보까지도 활용하여 로드 밸런싱 수행 가능
- 로드밸런서는 일반적으로 이중화나 다중화된 서버와 클라이언트 사이에 위치함
- 헬스 체크: 다중화된 서버 환경에서 어떤 서버에 문제가 생긴다면, 다른 서버들이 이를 빠르게 감지할 수 있어야하므로 다중화된 서버 환경에서 문제가 있는 서버는 없는지, 현재 요청에 대해 올바른 응답을 할 수 있는 상태인지 주기적으로 검사하는 것. 로드 밸런서에 의해 이루어지는 경우가 많고 HTTP, ICMP 등 다양한 프로토콜을 활용할 수 있음. 헬스체크 이외에도 하트비트라는 메시지를 주기적으로 서버끼리 주고 받으며 신호가 끊겼을 때 문제 발생을 감지하는 방식도 있음

### 로드 밸런싱 알고리즘

- 라운드 로빈 알고리즘: 서버를 돌아가며 부하를 전달하는 알고리즘
- 가중치 라운드 로빈 알고리즘: 라운드 로빈 알고리즘을 쓰되 서버에 가중치를 부여하여 가중치가 높은 서버가 더 많이 선택되어 더 많은 부하를 받도록 하는 것
- 최소 연결 알고리즘: 연결이 적은 서버부터 우선적으로 부하를 전달하는 알고리즘. 서버마다 가중치를 부여할 수 있음.
- 가중치 최소 연결 알고리즘: 최소 연결 알고리즘을 쓰되 서버에 가중치를 부여하여 가중치가 높은 서버가 더 많이 선택되어 더 많은 부하를 받도록 하는 것
- 무작위 연결
- 해시 자료구조를 이용한 연결
- 응답 시간이 가장 짧은 서버를 선택해서 연결

<br/><br/>

## 포워드 프록시와 리버스 프록시

- 클라이언트와 서버 사이에는 수많은 서버들이 존재할 수 있음
- 오리진 서버: 자원을 생성하고 클라이언트에게 권한 있는 응답을 보낼 수 있는 HTTP 서버
- 인바운드(inbound) 메시지: 오리진 서버를 향하는 메시지
- 아웃바운드(outbound) 메시지: 클라이언트를 향하는 메시지
- 프록시(포워드 프록시): HTTP 중간 서버의 유형으로 클라이언트가 선택한 메시지를 대신 전달함. 프록시를 언제 어떻게 사용할지는 클라이언트가 선택하고 일반적으로 오리진 서버보다 클라이언트와 더 가까이 위치함. 주로 캐시 저장, 클라이언트 암호화 및 접근 제한 기능을 수행함
- 게이트웨이(리버스 프록시): 네트워크 간의 통신을 가능하게 하는 입구 역할을 하는 하드웨어 혹은 소프트웨어를의미하나 HTTP 중간 서버 맥락에서는 아웃바운드 역할에 대해 오리진 서버 역할을 하지만 수신된 요청을 반환하여 다른 인바운드 서버들로 전달하는 중개자 역할을 함. 게이트웨이도 캐시를 저장할 수 있고 로드 밸런서로 동작할 수 있음

<br/><br/><br/><br/>

# 안정성을 위한 기술

## 암호와 인증서

### 대칭 키 암호화 방식과 공개 키 암호화 방식

- 암호화 알고리즘: 암호문을 생성하기 위해 키와 원문 데이터에 거치는 수학적 연산 과정

| 암호화 종류 | 대칭 키 암호화                                        | 공개 키 암호화                                                                                                                 |
| ----------- | ----------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------ |
| 설명        | 암호화와 복호화에 동일한 키를 사용하는 방식           | 암호화를 위한 키와 복호화를 위한 키가 다른 방식<br/>공개 키로 암호화하고 개인 키로 복호화하며 한 키로 다른 키를 유추할 수 없음 |
| 장점        | 적은 부하로, 암호화 및 복호화를 빠르게 수행할 수 있음 | 키를 안전하게 공유할 수 있음                                                                                                   |
| 단점        | 상대방에게 안전하게 키를 전달하기 어려움              | 시간과 부하가 상대적으로 많이 발생                                                                                             |

- 세션 키: 대칭 키 암호화 공개 키 암호화 방식을 함꼐 사용하는 방식에서 대칭 키를 가리킴. 세션 키를 공개키로 암호화한 후에 개인 키로 복호화 함. 대칭 키를 안전하게 공유하고, 공유한 대칭키를 이용해 빠른 암호화/복호화가 가능함

### 인증서와 디지털 서명

- 인증서: 무언가를 증명하기 위한 문서로, 네트워크에서 사용되는 인증서는 보통 공개 키 인증서를 말함
- 공개키 인증서: **공개 키**와 공개 키의 유효성을 입증하기 위한 전자 문서. 누가 생성 했는지, 조작되지 않았는지, 유효 기간이 언제까지인지 등이 포함되어 있음.
- 인증 기관(CA, Certification Authrity): 인증서의 발급, 검증, 저장과 같은 역할을 수행하는 공인 기관 (ex. IdenTrust, DigiCert, GlobalSign 등)
- 서명 값: CA 가 발급한 인증서에서 공개 키 인증서가 진짜임을 보증하는 내용을 담은 값. 클라이언트는 서명 값을 바탕으로 인증서를 검증할 수 있음. 인증서 내용에 대한 해시 값을 CA의 개인키로 암호화하는 방식으로 만들어짐.
- 지문: 인증서 내용에 대한 해시 값
- 해시 값: 해시 함수를 적용시킨 결괏값
- 해시 함수: 임의의 길이의 데이터를 고정된 데이터로 변환해주는 함수. (ex. MD5, SHA-1, SHA-2(SHA-256, SHA-384, SHA-512) 등이 있음) 입력된 데이터가 조금만 달라져도 완전히 다른 결과가 나오므로 데이터 변조 여부를 검사하는 데 사용됨
- 인증서 검증 과정
  <br/>1. 서명 값(인증서의 해시 값을 CA의 개인키로 암호화)과 인증서 분리
  <br/>2. 서명 값을 CA의 공개 키로 복호화 -> 인증서 내용에 대한 해시 값을 얻을 수 있음
  <br/>3. 인증서 데이터에 대한 해시 값을 구함
  <br/>4. 3번의 해시 값과 2번의 복호화 값을 비교함
- 디지털 서명: 개인 키로 암호화된 메시지를 공개 키로 복호화함으로써 신원을 증명하는 방식

<br/><br/>

## HTTPS: SSL과 TLS

- SSL과 TLS는 인증과 암호화를 수행하는 프로토콜로 TLS는 SSL을 계승한 프로토콜임
- SSL 2.0 -> SSL 3.0 -> TLS 1.0 -> TLS 1.1 -> TLS 1.2 -> TLS 1.3 순으로 출시(SSL 1.0은 출시되지 않았음)
- HTTPS: HTTP 메시지의 안전한 송수신을 위해 개발된 프로토콜로 SSL/TLS 기반 암호화 통신이 이루어짐

### HTTPS 동작 과정(TLS 1.3 기반)

1. TCP 쓰리 웨이 핸드셰이크
2. TLS 핸드셰이크: 암호화 통신을 위한 키를 교환하고 인증서 송수신과 검증이 이루어짐
3. 암호화된 메시지 송수신

### TLS 핸드셰이크

1. 클라이언트 -> 서버
   <br/>ClientHello 메시지 전송 -> 암호화된 통신을 위해 서로 맞춰 봐야 할 정보를 제시
   <br/>지원되는 TLS 버전, 암호 스위트(사용 가능한 암호화 방식, 해시 함수)정보, 키를 만들기 위해 사용할 클라이언트의 난수 등 포함
2. 서버 -> 클라이언트
   <br/>ServerHello 메시지 전송 -> 제시된 정보 중 암호화 통신에 사용할 정보를 선택. TLS 버전, 암호 스위트 등의 정보, 키를 만들기 위한 서버의 난수 등이 포함됨
   <br/>Certificate 메시지, CertificateVerify 매시지 전송 -> 인증서와 검증을 위한 디지털 서명으로 클라이언트는 이 메시지를 토대로 서버의 공개 키를 검증하게 됨
   <br/>Finished 메시지 전송 -> TLS 핸드셰이크의 마지막을 의미
   <br/>Applicatiion Data 라는 암호화된 메시지 전송(TLS 1.3)
3. 클라이언트 -> 서버
   <br/>Finished 메시지 전송
   <br/>Application Data라는 암호화된 메시지를 전송
4. 서버 -> 클라이언트, 클라이언트 -> 서버: Application Data 주고 받음

<br/><br/><br/><br/>

# 무선 네트워크

## 전파와 주파수

- 전파: 약 3kHz ~ 3Thz 사이의 진동수를 갖는 전자기파
- 무선 통신 기기가 사용하는 전파는 대부분 인위적으로 생성되고 관측되지만 자연적으로도 생성되고 관측됨
- 많은 기기가 전파를 통해 통신하므로 서로 다른 전파 신호가 같은 공간에 혼재할 수 있음 -> 전파 신호를 구분하기 위해 '주파수 대역'을 미리 정함
- 국가 별로 주파수 대역의 용도가 다르고 대한 민국은 방송용 주파수, 위성 통신용 주파수, 항공/해양 통신을 위한 주파수 등으로 나누어 사용함
- 자연적으로 생성되는 전파의 주파수가 우연히 할당된 주파수 대역과 겹치면 통신 중 잡음이 발생할 수 있음

<br/><br/>

## 와이파이와 802.11

- 오늘날 LAN 환경에서의 무선 통신은 IEEE 802.11 로 표준화 되어있음
- IEEE 802.11 표준은 대부분 2.4GHz 와 5 GHz 대역을 사용함
- IEEE 802.11의 버전에 따라 주파수뿐 아니라 전송 속도, 대역폭, 전송 가능한 거리, 변조 방식 등 많은 것이 달라짐
- 변조: 정보를 원하는 형태의 신호로 변환
- 복조: 변조된 신호를 원래의 정보로 다시 변환
- 와이파이: IEEE 802.11 표준을 따르는 무선 LAN 기술. 본래는 와이파이 얼리언스라는 비영리단체의 브랜드명이었음
- 와이파이는 와이파이 4, 와이파이 5 등으로 구분할 수 있는 세대가 있고 각기 다른 IEEE 802.11 표준 규격을 준수함
- 와이파이 인증 마크를 통해 제품이 IEEE 802.11 규격을 지켰는지, 다른 제품과 호환되는지를 알 수 있음

### 2.4 GHz vs 5GHz 와이파이

| 종류        | 2.4 GHz | 5GHz |
| ----------- | ------- | ---- |
| 장애물 영향 | 작음    | 큼   |
| 송수신 속도 | 느림    | 빠름 |

- 주파수에 따른 회절성으로 인해 위와 같은 차이가 발생함
- 회절성: 파동이 장애물이나 좁은 틈을 통과할 때 파동이 그 뒤편까지 전파되는 현상으로 낮은 주파수는 회절성이 좋고 높은 주파수는 회절성이 낮음

### 채널

- 주파수 대역은 채널이라 불리는 하위 주파수 대역으로 또 한번 세분화되어 같은 2.4GHz 혹은 5GHz 대역의 네트워크를 이용할지라도 세부적인 주파수는 채널에 따라 달라짐
- 채널에는 번호가 할당되어 있음
- 채널은 자동으로 설정되지만 수동으로 설정이 가능하며 같은 공간에서 같은 대역의 네트워크를 구성하거나 이용할 때는 가급적 간섭을 일으키지 않는 채널을 이용하는 것이 좋음

<br/><br/>

## AP와 서비스 셋

- AP: 무선 통신 기기들을 연결하여 무선 네트워크를 구성하는 장치 (ex. 무선 공유기)
- AP에는 일반적으로 유선 연결 매체를 연결할 수 있는 지점이 함께 제공되어 유선 네트워크와 무선 네트워크의 연결을 담당하는 역할도 수행할 수 있음
- 인프라스트럭처 모드(infrastructure mode): 무선 LAN의 기기들이 AP를 경유해 통신이 이루어지는 무선 네트워크 통신 방식
- 애드 혹 모드(Ad Hoc mode): AP의 간섭 없이 호스트 간에 일대일로 통신하는 무선 통신 모드
- 서비스 셋: 무선 네트워크를 이루는 AP 와 여러 장치들의 집합. 같은 서비스 셋에 속한 장치들은 같은 무선 네트워크에 속한다고 볼 수 있음
- 서비스 셋 식별자(SSID, Service Set IDentifier): 각기 다른 서비스 셋을 구분할 수 있는 수단. 무선 네트워크를 구분짓는 수단이자, 무선 네트워크를 지칭하는 고유의 이름이기도 함 (ex. 와이파이 이름)
- BSS(Basic Service Set): 하나의 AP 로 구성된 무선 LAN
- ESS(Extended Service Set): 여러 AP 로 구성된 무선 LAN
- 비컨 프레임(beacon frame): AP 가 불특정 다수 모두에게 자신의 존재를 지속히 알리기 위해 전송하는 브로드캐스트 메시지로 SSID, AP의 MAC 주소 등이 포함되어 있음
-
