# DNS와 자원

메시지를 주고받고자 하는 대상을 파악하기 위해서는 IP주소 이외에 도메인 네임을 사용할 수 있다.
위치 기반의 식별자 URL, 이름 기반의 식별자인 URN이 있습니다.

## 도메인 네임과 네임 서버

IP주소만 기억해서 통신하기에는 번거롭다. 그래서 일반적으로 상대 호스트를 특정하기 위해 IP주소보다 도메인 네임을 많이 사용한다.
도메인 네임은 호스트의 IP주소와 대응되는 문자열 형태의 호스트 특정 정보(문자열)

도메인 네임과 IP주소는 네임 서버에서 관리한다. 도메인 네임을 관리하는 네임서버는 DNS서버라고 한다.
도메인 네임을 네임 서버에 잘의하며 도메인 네임에 해당하는 IP주소를 반환해준다.

도메인 네임은 .을 기준으로 계층적으로 분류됩니다.
최상단에 루트 도메인, 그다음 단계인 최상위 도메인이 있으며, 그 다음 단계의 도메인이 있는 식
도메인 네임의 마지막 부분은 최상위 도메인, 줄여서 TLD라고 한다. (ex. com)

그리고 도메인 뒤에는 .으로 마무리되지만 일반적으로 생략해서 표시 (www.naver.com.)

최상위 도메인의 하부 도메인은 2단계 도메인이라고합니다. (ex. naver)
(ex.www는 3단계)

도메인 네임을 모두 포함하는 도메인 네임을 전체 주소 도메인 네임(FQDN)이라고 합니다.
앞부분까지 가면 호스트를 식별할 수 밖에 없기에 www를 호스트 네임이라고 부르기도 함.

이렇게 계층적이고, 분산된 도메인 네임에 대한 관리 체계를 도메인 네임 시스템 DNS라고 부른다.

## 계층적 네임 서버

IP주소를 모르는 상태에서 도메인 네임에 대응되는 IP주소를 알아내는 과정을 도메인 네임을 풀이한다. 리졸빙한다라고 한다.

이 과정에서 여러 네임서버가 사용되는데

1. 로컬 네임 서버
   클라이언트가 IP를 찾고할 때 가장 먼저 찾는 서버
   로컬 네임 서버의 주소는 ISP에 할당된 주소로 접속
   만약 서버가 IP를 모르면 루트 네임 서버에 질의하게 됨
2. 루트 네임 서버
   루트 도메인을 관장하는 네임 서버로 질의에 대해 TLD 네임 서버의 IP주소를 반환할 수 있다.
3. TLD 네임 서버
   TLD의 하위 도메인 네임을 관리하는 네임 서버 주소를 반환할 수 이싿. 하위 도메인 네임을 관리하는 네임서버는 마찬가지로 그보다 하위 도메인 네임을 관리하는 네임 서버 주소를 반환할 수 있다.
4. 책임 네임 서버
   특정 도메인 영역을 관리하는 네임 서버

로컬 네임 서버가 네임 서버들에게 질의하는 방법은 두 가지

1. 재귀적 질의
   로컬 -> 루트 -> TLD -> 책임에서 역순으로 최종 응답 결과를 듣는 방법

2. 반복적 질의
   로컬 <-> 루트, 로컬 <-> TLD, 로컬 <-> 책임 순으로 순서대로 질의를 주고 받는다.

리졸빙 과정이 8개의 단계를 걸쳐야 해서 시간과 네트워크 상의 메시지 수가 지나치게 늘어난다는 단점이 있음
한꺼번에 질의하면 서버에 과부화가 걸릴 수 있음

그래서 네임 서버들은 기존에 응답받은 결과를 임시로 저장했다 추후 같은 질의에 이를 활용함 이를 DNS 캐시라고 한다.
DNS 캐시를 저장하는 용도로만 사용되는 서버도 있다. (영원히 남는 건 아님 TTL로 저장될 시간이 있음)

## 자원을 식별하는 URL

자원이란 네트워크 상의 메시지를 통해 주고받느 대상을 의미
자원이란 HTTP 요청 메시지의 대상이라고도 표현

네트워크 상에서 자원을 주고받을려면 자원을 식별할 수 있어야 합니다. 자원을 식별할 수 있는 정보를 URI라고 부릅니다.
자원을 식별하는 통일된 방식이 URI

URI가 자원을 식별하는 정보에 따라 이름 바뀜

- 위치를 이용해 자원을 식별 : URL
- 이름을 이용해 자원을 식별 : URN

### URL

1. scheme
   자원을 접근하는 방법, http or https ...
2. authority
   호스트를 특정할 수 있는 정보, IP or 도메인 네임 :뒤에 포트 번호 덧붙이기 가능
3. path
   자원이 위치한 경로
4. query (쿼리 문자열, 쿼리 피라미터)
   물음표로 시작되는 <키=값> 형태의 데이터, &를 사용하여 여러 쿼리 문자열을 연결 할 수 있다.
5. fragment
   자원의 한 조각을 가리키기 위한 정보
   HTML 파일과 같은 자원에서 특정 부분을 가리키기 위해 사용

## URN

URL는 위치기반으로 위치가 변경되면 유효하지 않다.
반면 URN은 자원에 고유한 이름을 붙이는 이름 기반 식별자이기에 자원의 위치와 무관하게 자원을 식별할 수 있다는 장점이 있다.
ex) urn:isbn:23123213, urn:ietf:rtc:4234

### DNS 레코드 타입

네임 서버는 DNS 자원 레코드로 불리는 정보를 저장하고 관리한다.

## HTTP

응용 계층에서 정보를 주고받는데 사용되는 프로토콜입니다. HTTP이 네 가지 주요 특성

### 요청-응답 기반 프로토콜

클라이언트 - 서버 구조 기반의 요청-응답 기반 프로토콜

### 미디어 독립적 프로토콜

클라이언트는 HTTP요청 메시지를 통해 서버의 자원을 요청할 수 있고, 서버는 HTTP 응답 메시지로 요청받은 자원에 대해 응답할 수 있습니다.
HTTP는 주고받을 자원의 특성과 무관하게 자원을 주고받을 수단의 역할만을 수행합니다. (다양한 종류의 자원을 주고받을 수 있다)

HTTP에서 메시지를 주고받는 자원의 종류를 미디어 타입이라고 부릅니다.MIME 타입이라고 부른다. HTTP는 주고받을 미디어 타입에 특별히 제한을 두지 않고 독립적으로 동작이 가능한 미디어 독립 프로토콜이라고 한다.

미디어 타입은 일종의 웹 세상의 확장자와 같은 개념입니다. HTTP를 통해 송수신하는 정보의 종류는 미디어 타입으로 나타낼 수 있다.
미디어 타입은 기본적으로 슬래시를 기준으로 하는 타입/서브타입 형식으로 구성됩니다. 타입은 데이터의 유형을 나타내고, 서브탕비은 주어진 타입에 대한 세부 유형을 나타냅니다.

### 스테이트리스 프로토콜

상태를 유지 않는다. 이는 서버가 HTTP 요청을보낸 클라이언트와 관련된 상태를 기억하지 않는다는 의미. 그렇기 때문에 클라이언트의 모든 HTTP요청은 기본적을 독립적인 요청으로 간주된다.
서버와 클라이언트가 서로 종속적이지 않는다.
그렇기에 언제든지 서버를 투가할 수 있기 때문에 확장성이 높고, 서버중 하나에 문제가 생겨도 다른 서버로 대체가 가능하기에 경고성이 높다

### 지속 연결(킵 얼라이브) 프로토콜

HTTP 1.0에는 연결을 수립 후 요청에 대한 응답을 받으면 연결을 종료했는데 이젠 지속해서 연결함

## HTTP 메시지 구조

시작 라인, 필드 라인, 메시지 본문으로 이루어져 있다.

### 시작라인

HTTP 요청 메시지이면 요청 라인, 응답이면 상태라인이 된다.

요청 라인 형태 = 메서드 요청 대상 HTTP 버전

- 메서드 = 서버의 자원에 대해 수행할 작업의 종류 (GET, POST.. ..)
- 요청 대상 = HTTP 요청을 보낼 서버의 자원 (쿼리가 포한된 URI의 경로가 명시)

상태 라인 형태 = HTTP 버전 상태 코드 이유 구문

- 상태 코드 = 요청에 대한 결과를 나타내는 세 자리 정수
- 이유 구문 = 상태 코드에 대한 문자 열 형태의 설명

### 필드 라인

HTTP 헤더가 명시됨
헤더는 콜론을 기준으로 헤더 이름과 하나 이상의 헤더 값으로 구성된다.

# HTTP 헤더와 HTTP 기반의 기술

## HTTP 헤더

요청시 할용된느 HTTP 헤더

1. Host
   요청을 보낼 호스트를 나타내는 헤더, 주로 도메인 네임으로 명시된다.
2. User-Agent
   웹 브라우저와 같이 HTTP 요청을 시작하는 클라이언트 측의 프로그램을 의미
   헤더에는 이러한 정보, 즉 요청 메시지 생성에 관여한 클라이언트 프로그램과 관련된 다양한 정보가 명시된다.
3. Referer
   클라이언트가 요청을 보낼 때 머무르고 있던 URL이 명시된다.
4. Authorization
   클라이언트의 인증 정보를 담는 헤더. 인증 타입과 인증을 위한 정보가 차례로 명시되어 있다.

응답시 활용된느 헤더

1. Server
   요청을 처리하는 서버 측의 소프트웨어와 관련된 정보를 명시한다.
2. Allow
   클라이언트에게 허용된 HTTP 메시드 목록을 아려주기 위해 사용
3. Retry-after
   자원을 사용할 수 있는 날짜 혹은 시간을 나타낸다.
4. Location
   클라이언트에게 자원의 위치를 알려주기 위해 사용되는 헤더
5. WWW-Authenticate
   요청한 자원에 대한 유효한 인증이 없을 때 응답하는 코드

요청과 응답 모두에서 활용되는 헤더

1. Date
2. Connection
   클라이언트의 요청과 응답 간의 연결 방식을 설정한느 헤더
3. Content-Length
   본문의 바이트 크기 나타냄
4. Content-Type, Content-Language, Content-Encoding
   메세지 본문의 표현 방식을 설명한다는 점에서 표현 헤더라고 함

## 캐시

불필요한 대역폭 낭비와 응답 지연을 방지하기 위해 정보의 사본을 임시로 저장하는 기술

- 개인 전용 캐시: 웹 브라우저에 저장
- 공용 캐시: 클라이언트와 서버 사이에 위치한 중간 서버에 저장

## 쿠키

HTTP는 기본적으로 상태를 유지하지 않는 스테이트리스 프로토콜이다.
상태를 저장해야할 때에는 쿠키를 사용

쿠키란 서버에서 생성되어 클라이언트 측에 저장되는 데이터

서버는 쿠킬르 생성하여 클라이언트에게 전송하고, 클라이언트는 전달받은 쿠키를 저장해두었다가 추후 동일한 서버에 보내는 요청 메시지에 쿠키를 포함하여 전송합니다. 서버는 쿠키 정보를 참고해 두 개의 요청이 같은 클라이언트에서 왔는지, 로그인 상태를 유지하고 있는 지 등을 알 수 있다.
